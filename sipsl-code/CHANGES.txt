CHANGES

9 agosto

mettere nella context store i messaggi locked
-------------------------------------------------------------------------------

7 agosto

i messaggi resend devono essere cancellati
-------------------------------------------------------------------------------

4 agosto

nella comap metto lo stato della call_oset
se 0 vuold dire che non sta gestendo messaggi
se non 0 non la DOA non lo cancella
ma un messaggio potrebbe esere nella sl_cc mentre la doa cancella
e quindi lo cancellerebbe

-------------------------------------------------------------------------------

2 agosto

eliminato il codice per modificare i messaggi nelle SM
alo non è piu un engine

V6:
ALO is not engine anymore due to concurrency issues.
-------------------------------------------------------------------------------

1 Agosto

problemi di synch:
mutex
- CALL_OSET::call()

Alo: analizzare se conviene eliminare l'eredità da engine e farlo girare sul thread del sl_cc 

memoria:
estendere la mappa dei messaggi e qualsiasi oggetto e mettere il tipo
quando la call_oset ha raggiunto la fine della chiamata (bye-200ok) allora deve triggerare
la cancellazione di tutte le sue strutture
quindi o con la mappa oppure una mappa locale
-------------------------------------------------------------------------------

30 luglio
BYE ok


mettere a posto la map_context
mettere a posto le sequece

nella threadparser cambiata la posizione dell'unlock




29 luglio


correggere cseq di ACK
controllare transact machines degli ack (sv e cl)
modificare le transact machines degli invite perche non hanno piu l'ack
il bye non funzione....

transazione: branch
Cseq: no

problema: ACK arriva con un nuovo branch e non c'è il matchn con la SM dell'invite

-------------------------------------------------------------------------------

21 luglio
i cseq ancora non sono correttamente gestiti (?)
alcuni header (from/to/contact) sono sbaglaiti forse

non va piu niente dopo che ho corretto gli indirizzi su etc/hosts

-------------------------------------------------------------------------------


13 luglio
il callid per identificare l'allarme non è sufficente
-------------------------------------------------------------------------------
11 Luglio
Routing

Request INVITE
se è presente un Route header mandare a questo (porta di default 5060 se non indicata)
Mandare alla Request-URI altrimenti

Response
utilizza il Via per rispondere

Request Ack
come Invite


TODO: mettere a posto matrix
TODO: sistemare le classi state machine
-------------------------------------------------------------------------------
Luglio 9


introdurre un network dispatcher, togliere SODE_APOINT e SODE_BPOINT e lasciare SODE_NTWPOINT.
1. potrebbero esserci poi di due tier nella conversazione
2. la destinazione del messaggio è definita negli header e non in base alla macchina a stati

vedere: via , to, from, contact....


Bye from B ancora probloemi, forse la state machine client va modificata.
il bye non è mandato da quando ho invertito gli header

mettere ratio nella compilazione degli header
-------------------------------------------------------------------------------


Finire bye from B.
test
consolidare l'identificatore al call_oset con il call id semplice e non quello
esteso (cid+fromtag)
-------------------------------------------------------------------------------
Bye
la chiusura si fa con i vari tag e non con il sequence (?)

ok bye funziona

manca bye da lato B.

fare cleaning codice e 
-------------------------------------------------------------------------------
July 2

bye ok ma
getsequence va modificato perche il BYE viene mandato con il seq dell'invite +1
ora pero il bye che manda la sipsl deve essere basato sul bye di a:
se a manda un bye per un certo invite allora sipsl deve fare lo stesso
(perche potrei avere piu dialoghi aperti e il bye chiude un solo)
il sip sl deve capire quale invite si chiude e cercare il dialogo corretto.

finire bye

matrix e altrii messaggi memorizzati:
uare la mappa o un campo nel call_oset?
-------------------------------------------------------------------------------

matrix message: confusione!
finire bye

-------------------------------------------------------

24 giugno

fixed ACK con due call back a seconda del tipo di ack
il tipo di ACK è riconsiuto nel call_oset guardando se cè un invite con lo stesso CSeq e se è gia arrivato un 2xx
(questo lo fa guardando lo stato della macchina dell'invite)

chiamata connessa!

-------------------------------------------------------

23 giugno

non transactional ack:
se lo mando alla ALO non so che tipo di ack è 

quindi potrei:
l'ack lato B viene mandato con un nuovo tipo TYPE_NOTIF
la alo chiama  una call back diversa: onAckNoTrnsct()

TESTARE!!!
-------------------------------------------------------


23 giugno
correzione gestione headers

C_HeadCallId ok

C_HeadFrom fixed
C_HeadCSeq fixed
C_HeadContact fixed
C_HeadTo fixed
C_HeadVia fixed

sip-communicator doe not find the invite INVITE transaction

deve essere:
40 INVITE -> SIP
SIP -> 50 INVITE
40 ACK -> SIP
SIP -> 50 ACK

ma allora le transazioni???

-------------------------------------------------------

21 june
Ack still not working
7r/n ???
From and to are ok.

Decidere se il content di un header deve avere l'header o no!!!!

-------------------------------------------------------


June 10

ACK almost done,
need to fix this:

To: To: <sip:gugli_linphone@172.21.160.181:5061>;tag=9f7bc830
From: From: <sip:gugli_twinkle@guglicorp.com>;tag=9d448d81276175425117411

-------------------------------------------------------

V5 June 4
alarm fixed.
To do: the server state machine received the 180ringing from the client machine.

change: 
		TRNSCT_SM* trnsct_cl = call_oset->getTrnsctSm(_message->getHeadCSeq().getMethod().getContent(), SODE_TRNSCT_CL, _message->getHeadCSeq().getSequence());


V5 June 2

alarm issues 

-------------------------------------------------------------

V5 28 MAGGIO

fix alarm! must pause!
fix state machine design when invite has to be retransmitted!!!


--------------------------------------------------------------

28 Aprile

bye ancora non completo 

il messaggio matrice deve essere quello della transazione. quindi per esempio 
il 200OK generatore dalla valo deriva dall'invite oppure dal bye.


----> before
following is ???
fixe genMEssage v4??? is needede
I need to store INVITE A and INVITE B

************************************************************************************
12 bug
when parsing message
header: aaa aaa aaa aaa
is equivalent
header: aaa
 aaa
 aaa
(with space or tab)
************************************************************************************
************************************************************************************
************************************************************************************
11. fixed: all variable are stored in a map
store to tag from B (sent with DE or 180 RING or 200 OK)
10. fixed in call setup
contact 
------------------------------------------------------------------------------------
9. (extends bug 7) DONE SIPUTIL
must define a method oon which all the header changes are made in single part of the code
like SIP factory...
------------------------------------------------------------------------------------
8. fixed
outging INVITE has still the same call ID of the incoming
------------------------------------------------------------------------------------
7.
Rport, and other headers required to go to bside must be put in common from alo
and client machine, now they are hard coded.
------------------------------------------------------------------------------------
1.
Incorporate SIPENGINE and SL_CC into a single Engine and run SL_CO over a new Engine
This will allow to have a set of threads working on global data and a set of threads
working on call (subscriber) data.
ALO is engine.

------------------------------------------------------------------------------------
2.
The ALO cannot create a call, because the message coming from it must have a generator
The solution can be that ALO defines itself an APOINT so the message will be handled
like a new call.

------------------------------------------------------------------------------------
3. FIXED 
Change the Action and Alarm to support internal operation and message sending
Now MESSAGE and INTERNALOP are 
INTERNALOP : public MESSAGE
then use dynamic_cast to check if the incoming message is operation or not.

Fixed in other manner.

------------------------------------------------------------------------------------
4. FIXED 2OOok to ALO
Dialog established, ringing and 200 ok must first go to ALO and then to SMSV
ALO needs to build the message and send it to SMSV which changes state and
sends to network side A

------------------------------------------------------------------------------------
5. FIXED
Is it needed to have this as multimap???
callx-cally 1:n
typedef multimap<string, string> CALL_ID_Y2X;
changed to map.

------------------------------------------------------------------------------------
6. OK 
200 OK (and other replies) from B is sent to client sm and this one creates the new
reply for A.
It shoudl sent it to ALO. ALO can or not change it and forward to server sm, which
sinds it to A.

or:
200OK arrives from B, is sent to client sm which fwd it to ALO, ALO creates the new
200 ok (like the INVITE) and fwd to server sm which sends to A.

INVITE arrives to svsm the to ALO, ALO creates the INVITE
ALO must create the INVITE since it is made following business rules...

************************************************************************************
************************************************************************************
